<?php

/**
 * @file
 * Allows to create probabilistic weighted fields.
 */

/**
 * Implements hook_field_info().
 */
function probabilistic_weight_field_info() {

  return array(
    'probabilistic_weight' => array(
      'label' => t('Probabilistic weight'),
      'description' => t('Probabilistic weight'),
      'settings' => array(
        'max_length' => 128,
      ),
      'default_widget' => 'probabilistic_weight_text',
      'default_formatter' => 'probabilistic_weight_text',
      'field item class' => 'Drupal\probabilistic_weight\Type\ProbabilisticWeightItem',
    ),
  );

}

/**
 * Implements hook_field_is_empty().
 */
function probabilistic_weight_field_is_empty($item, $field_type) {

  return (!isset($item['weight']) || trim($item['weight'] === ''));

}

function probabilistic_weight_validation($element, &$form_state) {

  $value = $element['#value'];

  if (!is_numeric($value)) {
    form_set_error(
      $element['#parents'][0],
      t(
        '%field must be numeric.',
        array(
          '%field' => $element['#title'],
        )
      )
    );
  }
  elseif ($value < 0) {
    form_set_error(
      $element['#parents'][0],
      t(
        '%field must be greater or equal than 0.',
        array(
          '%field' => $element['#title'],
        )
      )
    );
  }
  elseif ($value > 1) {
    form_set_error(
      $element['#parents'][0],
      t(
        '%field must be lower or equal than 1.',
        array(
          '%field' => $element['#title'],
        )
      )
    );
  }

}

/**
 * Implements hook_views_api().
 */
function probabilistic_weight_views_api() {

  return array(
    'api' => 3,
  );

}
